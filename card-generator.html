---
layout: card
title: Card Generator (Pathfinder)
---

<html>
    <head>
        <style>
            @media print {
                .class-picker {
                    display: none !important;
                }

                .no-print {
                    display: none !important;
                }
            }

            @font-face {
                font-family: "Pathfinder-Icons";
                src: url("../assets/fonts/Pathfinder-Icons.ttf");
            }

            @font-face {
                font-family: "ActionIcons";
                src: url("../assets/fonts/action_icons.eot");
                src: url("../assets/fonts/action_icons.woff2") format("woff2"),
                    url("../assets/fonts/action_icons.woff") format("woff"),
                    url("../assets/fonts/action_icons.ttf") format("truetype");
                font-weight: normal;
                font-style: normal;
            }

            .no-print {
                filter: grayscale(0.8);
            }

            .class-picker {
                display: flex;
                justify-content: center;
            }

            .card-wrapper {
                display: inline-block;
            }

            .feat-card {
                display: inline-block;
                position: relative;
                width: 63mm;
                height: 89mm;
                padding: 0;
                margin: 5px;
                border-radius: 4.7619047619%;
                font-family: Helvetica Neue, Open Sans Condensed, sans-serif;
                font-weight: 400;
                font-size: 3mm;
                color: #111;
                text-align: center;
                overflow: hidden;
                background-color: #000;
            }
            .feat-card .action {
                font-family: "ActionIcons";
                font-weight: initial;
                text-transform: none;
            }
            .feat-card .action-action1:before {
                content: "\00E1";
            }
            .feat-card .action-action2:before {
                content: "\00E2";
            }
            .feat-card .action-action3:before {
                content: "\00E3";
            }
            .feat-card .action-free:before {
                content: "\00E0";
            }
            .feat-card .action-reaction:before {
                content: "\00E4";
            }
            .feat-card .name {
                background-color: #fff;
                position: absolute;
                top: 3mm;
                left: 3mm;
                width: 57mm;
                height: 5mm;
                border-radius: 2mm 2mm 0 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .feat-card .name .content {
                font-size: 3.5mm;
                text-transform: uppercase;
                font-weight: bold;
            }
            .feat-card .skill {
                position: absolute;
                top: 8mm;
                width: 100%;
                height: 3mm;
                text-transform: capitalize;
            }
            .feat-card .skill .content {
                color: #fff;
                font-size: 2mm;
                line-height: 3mm;
            }
            .feat-card .trait {
                background-color: #fff;
                text-align: center;
            }
            .feat-card .header {
                font-weight: bold;
                text-transform: uppercase;
                font-size: 3mm;
                color: #000;
            }
            .feat-card .description {
                background-color: #fff;
                display: inline-block;
                position: absolute;
                top: 11mm;
                left: 3mm;
                width: 55mm;
                padding: 1mm;
                text-align: justify;
                font-size: 2mm;
                height: 72mm;
                border-radius: 0 0 2mm 2mm;
            }
            .feat-card .description p {
                margin: 0;
                padding-left: 0;
                border: 0;
                padding-bottom: 0.5mm;
            }
            .feat-card .description ul {
                margin: 0;
                padding-left: 3mm;
                border: 0;
                padding-bottom: 0.5mm;
            }
            .feat-card hr {
                margin: 0;
                border: 0;
                position: relative;
                left: -1mm;
                width: 57mm;
                border-bottom: 1px solid black;
            }

            .spell-card {
                position: relative;
                width: 63mm;
                height: 89mm;
                padding: 0;
                margin: 5px;
                border-radius: 4.7619047619%;
                font-family: Helvetica Neue, Open Sans Condensed, sans-serif;
                font-weight: 400;
                font-size: 3mm;
                color: #111;
                text-align: center;
                overflow: hidden;
                background-color: #000;
            }
            .spell-card .action {
                font-family: "ActionIcons";
                font-weight: initial;
                text-transform: none;
            }
            .spell-card .action-action1:before {
                content: "\00E1";
            }
            .spell-card .action-action2:before {
                content: "\00E2";
            }
            .spell-card .action-action3:before {
                content: "\00E3";
            }
            .spell-card .action-free:before {
                content: "\00E0";
            }
            .spell-card .action-reaction:before {
                content: "\00E4";
            }
            .spell-card .name {
                background-color: #fff;
                position: absolute;
                top: 3mm;
                left: 3mm;
                width: 57mm;
                height: 5mm;
                border-radius: 2mm 2mm 0 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .spell-card .name .content {
                font-size: 3.5mm;
                text-transform: uppercase;
                font-weight: bold;
            }
            .spell-card .spell-level {
                position: absolute;
                top: 8mm;
                width: 100%;
                height: 3mm;
            }
            .spell-card .spell-level .content {
                color: #fff;
                font-size: 2mm;
                line-height: 3mm;
                text-transform: capitalize;
            }
            .spell-card .saving-throw,
            .spell-card .range {
                background-color: #fff;
                display: inline-block;
                position: absolute;
                top: 11mm;
                width: 28.25mm;
                height: 8mm;
                text-transform: capitalize;
            }
            .spell-card .saving-throw {
                left: 3mm;
                text-transform: capitalize;
            }
            .spell-card .range {
                left: 31.75mm;
                text-transform: capitalize;
            }
            .spell-card .components,
            .spell-card .duration {
                background-color: #fff;
                display: inline-block;
                position: absolute;
                top: 19.5mm;
                width: 28.25mm;
                height: 8mm;
                text-transform: capitalize;
            }
            .spell-card .components {
                left: 3mm;
            }
            .spell-card .duration {
                left: 31.75mm;
            }
            .spell-card .header {
                font-weight: bold;
                text-transform: uppercase;
                font-size: 3mm;
                color: #000;
            }
            .spell-card .description {
                background-color: #fff;
                display: inline-block;
                position: absolute;
                top: 30.5mm;
                left: 3mm;
                width: 53mm;
                padding: 2mm;
                text-align: justify;
                font-size: 2mm;
                height: 50mm;
                border-radius: 0 0 2mm 2mm;
            }
            .spell-card .description p {
                margin: 0;
                padding-left: 0;
                border: 0;
                padding-bottom: 1mm;
            }
            .spell-card .description ul {
                margin: 0;
                padding-left: 3mm;
                border: 0;
                padding-bottom: 1mm;
            }
            .spell-card hr {
                margin: 0;
                border: 0;
                position: relative;
                left: -2mm;
                width: 57mm;
                border-bottom: 1px solid black;
            }
        </style>
    </head>
    <body>
        <div class="class-picker">
            <input
                type="text"
                id="character-id"
                placeholder="Pathbuilder2e character id"
            />
            <input
                type="text"
                id="api-key"
                placeholder="Pathfinder2.fr api key"
            />
            <button id="fetch-data">Fetch</button>
        </div>
        <div id="cards"></div>
        <script>
            function saveFormValues() {
                var characterId = document.getElementById("character-id").value;
                if (characterId) {
                    localStorage.setItem("character-id", characterId);
                }

                var apiKey = document.getElementById("api-key").value;
                if (apiKey) {
                    localStorage.setItem("api-key", apiKey);
                }
            }

            async function getCharacterData(characterId) {
                var req = new Request(
                    `https://pathbuilder2e.com/json.php?id=${characterId}`,
                    { method: "GET" }
                );
                var response = await fetch(req);
                return response.json();
            }

            async function getFeatData(featName, featType, apiKey) {
                var headers = new Headers();
                headers.append("Authorization", apiKey);
                var endpoint = featType === "Heritage" ? "heritage" : "feat";

                var req = new Request(
                    `https://api.pathfinder2.fr/v1/pf2/${endpoint}?name=${featName}`,
                    { method: "GET", headers }
                );

                var response = await fetch(req);
                return response.json();
            }

            async function getSpecialData(specialName, apiKey) {
                var headers = new Headers();
                headers.append("Authorization", apiKey);
                var featData;

                var req = new Request(
                    `https://api.pathfinder2.fr/v1/pf2/classFeature?name=${specialName}`,
                    { method: "GET", headers }
                );

                var response = await fetch(req);
                var specialData = await response.json();
                var specialDataResponse = specialData.results.find(
                    (special) => special.name === specialName
                );
                if (specialDataResponse) {
                    return specialDataResponse;
                }

                var req = new Request(
                    `https://api.pathfinder2.fr/v1/pf2/ancestryFeature?name=${specialName}`,
                    { method: "GET", headers }
                );

                var response = await fetch(req);
                var specialData = response.json();
                return specialData;
            }

            async function getSpellData(spellName, apiKey) {
                var headers = new Headers();
                headers.append("Authorization", apiKey);

                var req = new Request(
                    `https://api.pathfinder2.fr/v1/pf2/spell?name=${spellName}`,
                    { method: "GET", headers }
                );

                var response = await fetch(req);
                return response.json();
            }

            function generateFeatCard(featName, featData) {
                if (featData.count === 0) {
                    console.log(`No data found for ${featName} card`);
                    return;
                }

                var feat = featData.results.find(
                    (feat) => feat.name === featName
                );
                console.log(
                    `Generating feat card: ${featName}`,
                    JSON.stringify(feat, null, 2)
                );

                var actionClass = generateActionType(
                    feat.system.actionType,
                    feat.system.actions
                );
                var traits = [
                    feat.system.traits.rarity,
                    ...feat.system.traits.value,
                ].join(", ");

                var description = generateDescription(
                    feat.system.description.value
                );
                var category = feat.system.category
                    ? feat.system.category
                    : "Special";

                var card = `<div class="card-wrapper">
                                <div class="feat-card">
                                    <div class="name">
                                        <div class="content">
                                            ${feat.name}
                                            <span class="action"><span class="${actionClass}" /></span>
                                        </div>
                                    </div>
                                    <div class="skill">
                                        <div class="content">${feat.type} (${category})</div>
                                    </div>
                                    <div class="description">
                                        <div class="trait">
                                            <div class="header">Trait</div>
                                            <div class="content">${traits}</div>
                                        </div>
                                        <hr/>
                                        ${description}
                                    </div>
                                </div>
                            </div>`;

                document.getElementById("cards").innerHTML += card;
            }

            function generateSpellCard(spellName, spellData) {
                if (spellData.count === 0) {
                    console.log(`No data found for ${spellName} card`);
                    return;
                }

                var spell = spellData.results.find(
                    (spell) => spell.name === spellName
                );
                console.log(
                    `Generating spell card: ${spellName}`,
                    JSON.stringify(spell, null, 2)
                );

                var actionClass = `action-action${
                    spell.system.time.value ? spell.system.time.value : ""
                }`;
                var spellLevel = generateSpellLevel(
                    spell.system.level.value,
                    spell.system.school.value,
                    spell.system.traits.value
                );
                var components = generateSpellComponents(
                    spell.system.components
                );
                var description = generateDescription(
                    spell.system.description.value
                );

                var card = `<div class="card-wrapper">
                                <div class="spell-card">
                                    <div class="name">
                                        <div class="content">
                                            ${spell.name}
                                            <span class="action"><span class="${actionClass}" /></span>
                                        </div>
                                    </div>
                                    <div class="spell-level">
                                        <div class="content">${spellLevel}</div>
                                    </div>
                                    <div class="saving-throw">
                                        <div class="header">Saving Throw</div>
                                        <div class="content">${orDash(
                                            spell.system.save.value
                                        )}</div>
                                    </div>
                                    <div class="range">
                                        <div class="header">Range</div>
                                        <div class="content">${orDash(
                                            spell.system.range.value
                                        )}</div>
                                    </div>
                                    <div class="components">
                                        <div class="header">Components</div>
                                        <div class="content">${orDash(
                                            components
                                        )}</div>
                                    </div>
                                    <div class="duration">
                                        <div class="header">Duration</div>
                                        <div class="content">${orDash(
                                            spell.system.duration.value
                                        )}</div>
                                    </div>
                                    <div class="description">${description}</div>
                                </div>
                            </div>`;

                document.getElementById("cards").innerHTML += card;
            }

            function generateSpecialCard(specialName, specialData) {
                console.log(
                    `Generating special card: ${specialName}`,
                    JSON.stringify(specialData, null, 2)
                );

                var special = specialData;
                if (specialData.results) {
                    if (specialData.count === 0) {
                        console.log(`No data found for ${specialName} card`);
                        return;
                    }
                    special = specialData.results.find(
                        (special) => special.name === specialName
                    );
                }

                var actionClass = generateActionType(
                    special.system.actionType,
                    special.system.actions
                );
                var traits = [
                    special.system.traits.rarity,
                    ...special.system.traits.value,
                ].join(", ");

                var description = generateDescription(
                    special.system.description.value
                );
                var category = special.system.category
                    ? special.system.category.replace("feature", "")
                    : "Special";

                var card = `<div class="card-wrapper">
                                <div class="feat-card">
                                    <div class="name">
                                        <div class="content">
                                            ${special.name}
                                            <span class="action"><span class="${actionClass}" /></span>
                                        </div>
                                    </div>
                                    <div class="skill">
                                        <div class="content">${special.type} (${category})</div>
                                    </div>
                                    <div class="description">
                                        <div class="trait">
                                            <div class="header">Trait</div>
                                            <div class="content">${traits}</div>
                                        </div>
                                        <hr/>
                                        ${description}
                                    </div>
                                </div>
                            </div>`;

                document.getElementById("cards").innerHTML += card;
            }

            function generateActionType(actionType, actions) {
                if (actionType) {
                    return `action-${actionType.value}${
                        actions.value ? actions.value : ""
                    }`;
                }
            }
            function generateDescription(description) {
                return `${description
                    .replace(/@UUID\[.*\]\{(.*)\}/, "$1")
                    .replace(/\[\[\/r.(.*)\[(.*)\]\]\]/, "$1 $2")}`;
            }

            function generateSpellLevel(level, school, traits) {
                if (traits.includes("cantrip")) {
                    return `${school} Cantrip`;
                }
                switch (level) {
                    case 1:
                        return `${level}st-level ${school}`;
                    case 2:
                        return `${level}nd-level ${school}`;
                    case 3:
                        return `${level}rd-level ${school}`;
                    default:
                        return `${level}th-level ${school}`;
                }
            }

            function generateSpellComponents(components) {
                return [
                    ...(components.verbal ? ["V"] : []),
                    ...(components.somatic ? ["S"] : []),
                    ...(components.material ? ["M"] : []),
                    ...(components.focus ? ["focus"] : []),
                ].join(", ");
            }

            function orDash(val) {
                return val ? val : `&mdash;`;
            }

            async function createCards(characterId, apiKey) {
                console.log("Fetching character data");

                var character = await getCharacterData(characterId);
                console.log(
                    "Character fetched",
                    JSON.stringify(character, null, 2)
                );

                var featNames = character.build.feats.forEach(async (feat) => {
                    var featName = feat[0];
                    var featType = feat[2];
                    console.log(`Fetching feat data for ${featName}`);
                    var featData = await getFeatData(
                        featName,
                        featType,
                        apiKey
                    );
                    generateFeatCard(featName, featData);
                });

                var spellNames = character.build.spellCasters
                    .map((spellCasters) =>
                        spellCasters.spells.map((spells) => spells.list).flat()
                    )
                    .flat();

                spellNames.forEach(async (spellName) => {
                    console.log(`Fetching spell data for ${spellName}`);
                    var spellData = await getSpellData(spellName, apiKey);
                    generateSpellCard(spellName, spellData);
                });

                character.build.specials.forEach(async (specialName) => {
                    console.log(`Fetching special data for ${specialName}`);
                    var specialData = await getSpecialData(specialName, apiKey);
                    generateSpecialCard(specialName, specialData);
                });
            }

            document
                .getElementById("fetch-data")
                .addEventListener("click", async (_) => {
                    saveFormValues();
                    var characterId =
                        document.getElementById("character-id").value;
                    var apiKey = document.getElementById("api-key").value;
                    createCards(characterId, apiKey);
                });

            (() => {
                var characterId = localStorage.getItem("character-id");
                if (characterId) {
                    document.getElementById("character-id").value = characterId;
                }
                var apiKey = localStorage.getItem("api-key");
                if (apiKey) {
                    document.getElementById("api-key").value = apiKey;
                }
            })();
        </script>
    </body>
</html>
