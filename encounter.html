---
layout: default
title: Encounters
---

<div class="inputs">
  <div>
    <label>Average Party Level</label> <input class="js-level" type="number" placeholder="Average Party Level" min="1" max="20" autofocus="true" />
  </div>
  <div>
    <label>Number of Players</label> <input class="js-players" type="number" placeholder="Number of Players" min="1" max="20" />
  </div>
  <div>
    <label>Boss</label>
    <select class="js-boss">
      <option>None</option>
      <option>Heavy</option>
      <option>Light</option>
      <option>Ranged</option>
      <option>Arcane Caster</option>
      <option>Divine Caster</option>
    </select>
  </div>
</div>

<div id="encounters"></div>

<div id="template" class="encounter">
  <div class="name">
    <span class="js-name"></span>
  </div>
  <div>
    <div class="two-column">
      <div><b>Level</b> <span class="js-level"></span></div>
      <div><b>Armour Class</b> <span class="js-ac"></span></div>
      <div><b>Hit Points</b> <span class="js-hp"></span></div>
    </div>
    <div class="two-column">
      <div><b>Speed</b> 30ft.</div>
      <div><b>Initiative</b> <span class="js-initiative"></span></div>
    </div>
  </div>
  <div class="name">Attributes</div>
  <table>
    <tr>
      <th></th>
      <th>STR</th>
      <th>DEX</th>
      <th>CON</th>
      <th>INT</th>
      <th>WIS</th>
      <th>CHA</th>
    </tr>
    <tr>
      <td><b>Base</b></td>
      <td><span class="js-str-base"></span></td>
      <td><span class="js-dex-base"></span></td>
      <td><span class="js-con-base"></span></td>
      <td><span class="js-int-base"></span></td>
      <td><span class="js-wis-base"></span></td>
      <td><span class="js-cha-base"></span></td>
    </tr>
    <tr>
      <td><b>Mod</b></td>
      <td>(<span class="js-str-mod"></span>)</td>
      <td>(<span class="js-dex-mod"></span>)</td>
      <td>(<span class="js-con-mod"></span>)</td>
      <td>(<span class="js-int-mod"></span>)</td>
      <td>(<span class="js-wis-mod"></span>)</td>
      <td>(<span class="js-cha-mod"></span>)</td>
    </tr>
    <tr>
      <td><b>DC</b></td>
      <td><span class="js-str-dc"></span></td>
      <td><span class="js-dex-dc"></span></td>
      <td><span class="js-con-dc"></span></td>
      <td><span class="js-int-dc"></span></td>
      <td><span class="js-wis-dc"></span></td>
      <td><span class="js-cha-dc"></span></td>
    </tr>
    <tr>
      <td><b>Save</b></td>
      <td><span class="js-str-save"></span></td>
      <td><span class="js-dex-save"></span></td>
      <td><span class="js-con-save"></span></td>
      <td><span class="js-int-save"></span></td>
      <td><span class="js-wis-save"></span></td>
      <td><span class="js-cha-save"></span></td>
    </tr>
  </table>
  <div class="js-skills name">Skills &#9662;</div>
  <div class="js-skills-list skills">
    <div class="two-column">
      <div><b>Acrobatics</b> <span class="js-acrobatics"></span></div>
      <div><b>Animal Handling</b> <span class="js-animal-handling"></span></div>
      <div><b>Arcana</b> <span class="js-arcana"></span></div>
      <div><b>Athletics</b> <span class="js-athletics"></span></div>
      <div><b>Deception</b> <span class="js-deception"></span></div>
      <div><b>History</b> <span class="js-history"></span></div>
      <div><b>Insight</b> <span class="js-insight"></span></div>
      <div><b>Intimidation</b> <span class="js-intimidation"></span></div>
      <div><b>Investigation</b> <span class="js-investigation"></span></div>
    </div>
    <div class="two-column">
      <div><b>Medicine</b> <span class="js-medicine"></span></div>
      <div><b>Nature</b> <span class="js-nature"></span></div>
      <div><b>Perception</b> <span class="js-perception"></span></div>
      <div><b>Performance</b> <span class="js-performance"></span></div>
      <div><b>Persuasion</b> <span class="js-persuasion"></span></div>
      <div><b>Religion</b> <span class="js-religion"></span></div>
      <div><b>Sleight of Hand</b> <span class="js-sleight-of-hand"></span></div>
      <div><b>Stealth</b> <span class="js-stealth"></span></div>
      <div><b>Survival</b> <span class="js-survival"></span></div>
    </div>
  </div>
  <div class="actions">
    <div class="js-actions name">Actions &#9662;</div>
    <div class="js-actions-list">
      <div><b><i>Attack</i></b> <i>Melee Weapon attack:</i> (+<span class="js-attack-to-hit"></span>) to hit.</div>
      <div><i>Hit:</i> (<span class="js-attack-damage-die"></span> +<span class="js-attack-damage-mod"></span>) damage.</div>
      <div><b><i>Multiattack</i></b> <span class="js-multiattack"></span></div>
      <div><i>Hit:</i> (<span class="js-multiattack-damage-die"></span> +<span class="js-multiattack-damage-mod"></span>) damage.</div>
      <div class="js-spellcasting">
        <div><b><i>Spellcasting</i></b> <i>Spell attack:</i> (+<span class="js-spell-to-hit"></span>) to hit.</div>
        <table class="spellcasting">
          <tr>
            <th>Cantrips</th>
            <th>1st</th>
            <th>2nd</th>
            <th>3rd</th>
            <th>4th</th>
            <th>5th</th>
            <th>6th</th>
            <th>7th</th>
            <th>8th</th>
            <th>9th</th>
          </tr>
          <tr>
            <td>At will</td>
            <td><span class="js-1-slot">&mdash;</span></td>
            <td><span class="js-2-slot">&mdash;</span></td>
            <td><span class="js-3-slot">&mdash;</span></td>
            <td><span class="js-4-slot">&mdash;</span></td>
            <td><span class="js-5-slot">&mdash;</span></td>
            <td><span class="js-6-slot">&mdash;</span></td>
            <td><span class="js-7-slot">&mdash;</span></td>
            <td><span class="js-8-slot">&mdash;</span></td>
            <td><span class="js-9-slot">&mdash;</span></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <div class="reactions">
    <div class="js-reactions name">Reactions &#9662;</div>
    <div class="js-reactions-list"></div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function() {
    $('#encounters').sortable()
    $('#encounters').disableSelection()

    $('.js-players').on('change', encounter)
    $('.js-level').on('change', encounter)
    $('.js-boss').on('change', bossEncounter)
  })

  function encounter() {
    var players = parseInt($('.js-players').val())
    var level = parseInt($('.js-level').val())

    if(parseInt(players, 10) && parseInt(level, 10)) {
      clearEncounters()
      var numberOfEnemies = calculateNumberOfEnemies(players)

      do {
        var sizeOfGroup = d(4) + 1
        $('#encounters').append(generateEncounterGroup(sizeOfGroup, selectArchetype(), level))

        numberOfEnemies -= sizeOfGroup
      }
      while(numberOfEnemies >= 5)
      $('#encounters').append(generateEncounterGroup(numberOfEnemies, selectArchetype(), level))
    }

    sortEncounters()
  }

  function bossEncounter() {
    var level = parseInt($('.js-level').val())
    var archetype = $('.js-boss').val()

    $('.js-boss-encounter').remove()

    if(parseInt(level, 10) && archetype !== 'None') {
      boss = generateEncounterGroup(1, selectArchetype(archetype), (level + 3))
      boss.find('.js-name').text(boss.find('.js-name').text().replace('(1)', '(BOSS)'))
      boss.removeClass('js-encounter-group')
      boss.addClass('js-boss-encounter')
      $('#encounters').prepend(boss)
    }
  }

  function d(sides) {
    return Math.floor(Math.random() * sides) + 1
  }

  function clearEncounters() {
    $('.js-encounter-group').remove()
  }

  function calculateNumberOfEnemies(numberOfPlayers) {
    return numberOfPlayers + d(Math.min(numberOfPlayers, 2))
  }

  function sortEncounters() {
    encountersContainer = $('#encounters')
    encounters = encountersContainer.children('.js-encounter-group')

    encounters.sort(function(a, b) {
      var an = parseInt($(a).find('.js-initiative').text(), 10)
      var bn = parseInt($(b).find('.js-initiative').text(), 10)
      if(an > bn) {
        return -1;
      }
      if(an < bn) {
        return 1;
      }
      return 0;
    })

    encounters.detach().appendTo(encountersContainer)
  }

  function selectArchetype(archetypeIdentifier) {
    var archetypes = [
      {
        role: 'Heavy'
        ,hitDie: 12
        ,ac: function(dexModifier) { return 14 + d(6) }
        ,abilityWeighting: ['str', 'con']
        ,skillProficiencies: [ 'athletics', 'intimidation', 'perception', 'survival', 'medicine', 'history' ]
        ,spellcasting: false
        ,reactions: [
          {
            name: 'Parry'
            ,description: function(proficiencyBonus) { return 'Add +' + proficiencyBonus + ' to AC against one melee attack that would hit it.' }
          }
          ,{
            name: 'Shield'
            ,description: function(proficiencyBonus) { return 'When a creature makes an attack against an ally wihtin 5 feet that would hit, add +2 to their AC' }
          }
          ,{
            name: 'Redirect Attack'
            ,description: function(proficiencyBonus) { return 'Choose an ally within 5 feet and swap places. The chosen ally becomes the target instead.' }
          }
        ]
      }
      ,{
        role: 'Light'
        ,hitDie: 10
        ,ac: function(dexModifier) { return (11 + d(4) + Math.min(2, dexModifier)) }
        ,abilityWeighting: ['dex', 'con']
        ,skillProficiencies: [ 'acrobatics', 'stealth', 'sleight-of-hand', 'investigation', 'perception', 'deception' ]
        ,spellcasting: false
        ,reactions: [
          {
            name: 'Parry'
            ,description: function(proficiencyBonus) { return 'Add +' + proficiencyBonus + ' to AC against one melee attack that would hit it.' }
          }
          ,{
            name: 'Shield'
            ,description: function(proficiencyBonus) { return 'When a creature makes an attack against an ally wihtin 5 feet that would hit, add +2 to their AC' }
          }
          ,{
            name: 'Redirect Attack'
            ,description: function(proficiencyBonus) { return 'Choose an ally within 5 feet and swap places. The chosen ally becomes the target instead.' }
          }
        ]
      }
      ,{
        role: 'Ranged'
        ,hitDie: 8
        ,ac: function(dexModifier) { return (11 + d(4) + Math.min(2, dexModifier)) }
        ,abilityWeighting: ['dex', 'wis']
        ,skillProficiencies: [ 'acrobatics', 'stealth', 'nature', 'perception', 'survival', 'animal-handling' ]
        ,spellcasting: false
        ,reactions: []
      }
      ,{
        role: 'Arcane Caster'
        ,hitDie: 6
        ,ac: function(dexModifier) { return 10 + dexModifier }
        ,abilityWeighting: ['int', 'cha']
        ,skillProficiencies: [ 'arcana', 'history', 'investigation', 'deception', 'persuasion' ,'sleight-of-hand' ]
        ,spellcasting: true
        ,school: [
          {
            name: 'Mage'
            ,spells: [
              {
                level: 'Cantrips'
                ,spells: ['fire bolt', 'light', 'mage hand', 'prestidigitation']
              }
              ,{
                level: '1st level'
                ,spells: ['detect magic', 'mage armor', 'magic missile', 'shield']
              }
              ,{
                level: '2nd level'
                ,spells: ['misty step', 'suggestion']
              }
              ,{
                level: '3rd level'
                ,spells: ['counterspell', 'fireball', 'fly']
              }
              ,{
                level: '4th level'
                ,spells: ['greater invisibility', 'ice storm']
              }
              ,{
                level: '5th level'
                ,spells: ['cone of cold']
              }
            ]
          }
          ,{
            name: 'Archmage'
            ,spells: [
              {
                level: 'Cantrips'
                ,spells: ['fire bolt', 'light', 'mage hand', 'prestidigitation', 'shocking grasp']
              }
              ,{
                level: '1st level'
                ,spells: ['detect magic', 'identify', 'mage armor', 'magic missile']
              }
              ,{
                level: '2nd level'
                ,spells: ['detect thoughts', 'mirror image', 'misty step']
              }
              ,{
                level: '3rd level'
                ,spells: ['counterspell', 'fly', 'lightning bolt']
              }
              ,{
                level: '4th level'
                ,spells: ['banishment', 'fire shield', 'stoneskin']
              }
              ,{
                level: '5th level'
                ,spells: ['cone of cold', 'scrying', 'wall of force']
              }
              ,{
                level: '6th level'
                ,spells: ['globe of invulnerability']
              }
              ,{
                level: '7th level'
                ,spells: ['teleport']
              }
              ,{
                level: '8th level'
                ,spells: ['mind blank']
              }
              ,{
                level: '9th level'
                ,spells: ['time stop']
              }
            ]
          }
        ]
        ,reactions: [
          {
            name: 'Counterspell'
            ,description: function(proficiencyBonus) { return '(3rd Level) If the creature is casting a spell of 3rd level or lower, its spell fails and has no effect. If it is casting a spell of 4th level or higher, make an ability check using your spellcasting ability. The DC equals 10 + the spell’s level. On a success, the creature’s spell fails and has no effect.' }
          }
          ,{
            name: 'Feather Fall'
            ,description: function(proficiencyBonus) { return '(1st Level) Choose up to five falling creatures within range. A falling creature’s rate of descent slows to 60 feet per round until the spell ends. If the creature lands before the spell ends, it takes no falling damage and can land on its feet, and the spell ends for that creature.' }
          }
          ,{
            name: 'Hellish Rebuke'
            ,description: function(proficiencyBonus) { return '(1st Level) The creature must make a Dexterity saving throw. It takes 2d10 fire damage on a failed save, or half as much damage on a successful one.' }
          }
          ,{
            name: 'Shield'
            ,description: function(proficiencyBonus) { return '(1st Level) Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from magic missile.' }
          }
        ]
      }
      ,{
        role: 'Divine Caster'
        ,hitDie: 8
        ,ac: function(dexModifier) { return 13 + d(6) }
        ,abilityWeighting: ['str', 'wis']
        ,skillProficiencies: [ 'athletics', 'insight', 'perception', 'medicine', 'religion', 'persuasion' ]
        ,spellcasting: true
        ,school: [
          {
            name: 'Priest'
            ,spells: [
              {
                level: 'Cantrips'
                ,spells: ['light', 'sacred flame ', 'thaumaturgy']
              }
              ,{
                level: '1st level'
                ,spells: ['cure wounds', 'guiding bolt', 'sanctuary']
              }
              ,{
                level: '2nd level'
                ,spells: ['lesser restoration', 'spiritual weapon']
              }
              ,{
                level: '3rd level'
                ,spells: ['dispel magic', 'spirit guardians']
              }
            ]
          }
          ,{
            name: 'Druid'
            ,spells: [
              {
                level: 'Cantrips'
                ,spells: ['druidcraft', 'produce flame', 'shillelagh']
              }
              ,{
                level: '1st level'
                ,spells: ['entangle', 'longstrider', 'speak with animals', 'thunderwave']
              }
              ,{
                level: '2nd level'
                ,spells: ['animal messenger', 'barkskin']
              }
            ]
          }
          ,{
            name: 'Cultist'
            ,spells: [
              {
                level: 'Cantrips'
                ,spells: ['light', 'sacredflame', 'thaumaturgy']
              }
              ,{
                level: '1st level'
                ,spells: ['command', 'inflict wounds', 'shield of faith ']
              }
              ,{
                level: '2nd level'
                ,spells: ['hold person', 'spiritual weapon']
              }
            ]
          }
        ]
        ,reactions: [
          {
            name: 'Parry'
            ,description: function(proficiencyBonus) { return 'Add +' + proficiencyBonus + ' to AC against one melee attack that would hit it.' }
          }
          ,{
            name: 'Shield'
            ,description: function(proficiencyBonus) { return 'When a creature makes an attack against an ally wihtin 5 feet that would hit, add +2 to their AC' }
          }
        ]
      }
    ]

    for(i = 0; i < archetypes.length; i++) {
      if(archetypes[i].role == archetypeIdentifier) {
        return archetypes[i]
      }
    }
    return archetypes[d(archetypes.length) - 1]
  }

  function isProficientWithAttribute(archetype, ability) {
    return (archetype.abilityWeighting.indexOf(ability) != -1)
  }

  function isProficientWithSkill(archetype, skill) {
    return (archetype.skillProficiencies.indexOf(skill) != -1)
  }

  function calculateAttributes(averagePartyLevel) {
    var baseAttributes = [ 15, 14, 13, 12, 10, 8 ]
    var additionalAttributes = 4 + 2 * Math.floor(averagePartyLevel / 4)
    for(i = 0; i < additionalAttributes; i++) {
      baseAttributes[d(6) - 1] += 1
    }

    return baseAttributes
  }

  function calculateAttributeModifier(attribute) {
    return Math.floor(attribute/2 - 5)
  }

  function calculateDC(abilityModifier, proficiencyBonus, isProficientWithAttribute) {
    return 10 + abilityModifier + (isProficientWithAttribute ? proficiencyBonus : 0)
  }

  function calculateSaveModifier(abilityModifier, proficiencyBonus, isProficientWithAttribute) {
    return abilityModifier + (isProficientWithAttribute ? proficiencyBonus : 0)
  }

  function calculateSkillModifier(abilityModifier, proficiencyBonus, isProficientWithSkill) {
    return abilityModifier + (isProficientWithSkill ? proficiencyBonus : 0)
  }

  function calculateProficiencyBonus(averagePartyLevel) {
    return 1 + Math.ceil(averagePartyLevel/4)
  }

  function calculateHitPoints(hitDie, conModifier, averagePartyLevel) {
    return hitDie + conModifier + (averagePartyLevel - 1) * (Math.floor(hitDie/2) + 1 + conModifier)
  }

  function calculateSpellSlots(averagePartyLevel) {
    var spellSlots = [
       [2]
      ,[3]
      ,[4,2]
      ,[4,3]
      ,[4,3,2]
      ,[4,3,3]
      ,[4,3,3,1]
      ,[4,3,3,2]
      ,[4,3,3,3,1]
      ,[4,3,3,3,2]
      ,[4,3,3,3,2,1]
      ,[4,3,3,3,2,1]
      ,[4,3,3,3,2,1,1]
      ,[4,3,3,3,2,1,1]
      ,[4,3,3,3,2,1,1,1]
      ,[4,3,3,3,2,1,1,1]
      ,[4,3,3,3,2,1,1,1,1]
      ,[4,3,3,3,3,1,1,1,1]
      ,[4,3,3,3,3,2,1,1,1]
      ,[4,3,3,3,3,2,2,1,1]
    ]

    return spellSlots[averagePartyLevel - 1]
  }

  function calculateBeastialLikelihood(archetype) {
    if(archetype.role == 'Heavy' || archetype.role == 'Light') {
      return (d(4) === 1)
    }
    else {
      return false
    }
  }

  function generateEncounterGroup(sizeOfGroup, archetype, averagePartyLevel) {
    if(sizeOfGroup < 1) {
      return
    }

    var template = $('#template').clone()
    template.attr('id', '')
    template.addClass('js-encounter-group')

    var beastial = calculateBeastialLikelihood(archetype)
    var baseAttributes = calculateAttributes(averagePartyLevel)
    var proficiencyBonus = calculateProficiencyBonus(averagePartyLevel)

    var abilityModifiers = fillInAbilityTable(template, baseAttributes, beastial, proficiencyBonus, archetype)
    fillInSkillTable(template, abilityModifiers, proficiencyBonus, archetype)

    template.find('.js-name').text((beastial ? 'Beastial ' : '') + archetype.role + ' (' + sizeOfGroup + ')')
    template.find('.js-level').text(averagePartyLevel)
    template.find('.js-ac').text(archetype.ac(abilityModifiers.dex))
    template.find('.js-hp').text(calculateHitPoints(archetype.hitDie, abilityModifiers.con, averagePartyLevel))
    template.find('.js-initiative').text(abilityModifiers.dex + d(20))

    template.find('.js-attack-to-hit').text(Math.max(abilityModifiers.str, abilityModifiers.dex) + proficiencyBonus + d(2))
    template.find('.js-attack-damage-die').text(Math.ceil(proficiencyBonus/2) + 'd' + (archetype.hitDie - 2))
    template.find('.js-attack-damage-mod').text(Math.max(abilityModifiers.str, abilityModifiers.dex) + d(2))
    template.find('.js-multiattack').text(proficiencyBonus)
    template.find('.js-multiattack-damage-die').text(Math.floor(proficiencyBonus/3) + 'd' + (archetype.hitDie - 4))
    template.find('.js-multiattack-damage-mod').text(Math.max(abilityModifiers.str, abilityModifiers.dex))
    if(!archetype.spellcasting) {
      template.find('.js-spellcasting').hide()
    }
    else {
      var spellSlots = calculateSpellSlots(averagePartyLevel)
      for(i=0; i < spellSlots.length; i++) {
        template.find('.js-' + (i+1) + '-slot').text(spellSlots[i])
      }
      if(archetype.role == 'Divine Caster') {
        template.find('.js-spell-to-hit').text(abilityModifiers.wis + proficiencyBonus + d(2))
      }
      else {
        template.find('.js-spell-to-hit').text(Math.max(abilityModifiers.int, abilityModifiers.cha) + proficiencyBonus + d(2))
      }
      fillInCasterSchool(template, archetype)
    }

    if(!beastial) {
      fillInReaction(template, archetype, proficiencyBonus)
      template.find('.js-reactions').on('click', function() { template.find('.js-reactions-list').toggle() })
      template.find('.js-reactions')
    }

    template.find('.js-skills').on('click', function() { template.find('.js-skills-list').toggle() })
    template.find('.js-actions').on('click', function() { template.find('.js-actions-list').toggle() })

    return template
  }

  function fillInAbilityTable(encounterGroup, baseAttributes, beastial, proficiencyBonus, archetype) {
    var modifiers = distributeAttributes(encounterGroup, baseAttributes, archetype, beastial)

    var attributes = [ 'str', 'dex', 'con', 'int', 'wis', 'cha' ]
    for(i = 0; i < attributes.length; i++) {
      var attribute = attributes[i]
      var modifier = modifiers[attribute]
      var plusSymbol = (modifier < 0 ? '' : '+')

      encounterGroup.find('.js-' + attribute + '-mod').text(plusSymbol + modifier)
      encounterGroup.find('.js-' + attribute + '-dc').text(calculateDC(modifier, proficiencyBonus, isProficientWithAttribute(archetype, attribute)))
      encounterGroup.find('.js-' + attribute + '-save').text(plusSymbol + calculateSaveModifier(modifier, proficiencyBonus, isProficientWithAttribute(archetype, attribute)))
    }

    return modifiers
  }

  function distributeAttributes(encounterGroup, baseAttributes, archetype, beastial) {
    var abilityModifiers = { }
    var dumpAbilities = [ 'str', 'dex', 'con', 'int', 'wis', 'cha' ]

    for(i = 0; i < archetype.abilityWeighting.length; i++) {
      var prioritizedAttribute = archetype.abilityWeighting[i]
      var prioritizedAttributeIndex = dumpAbilities.indexOf(prioritizedAttribute)
      dumpAbilities.splice(prioritizedAttributeIndex, 1)

      var largestAbility = Math.max.apply(Math,baseAttributes)
      var largestAbilityIndex = baseAttributes.indexOf(largestAbility)
      var ability = baseAttributes.splice(largestAbilityIndex, 1)

      encounterGroup.find('.js-' + prioritizedAttribute + '-base').text(ability)
      abilityModifiers[prioritizedAttribute] = calculateAttributeModifier(ability)
    }

    for(i = 0; i < dumpAbilities.length; i++) {
      var randomAbility = dumpAbilities[i]
      var randomAbilityIndex = d(baseAttributes.length) - 1
      var ability = baseAttributes.splice(randomAbilityIndex, 1)
      encounterGroup.find('.js-' + randomAbility + '-base').text(ability)
      abilityModifiers[randomAbility] = calculateAttributeModifier(ability)
    }

    if(beastial) {
      var int = d(6)
      encounterGroup.find('.js-int-base').text(int)
      abilityModifiers['int'] = calculateAttributeModifier(int)

      var cha = d(6) +  d(6)
      encounterGroup.find('.js-cha-base').text(cha)
      abilityModifiers['cha'] = calculateAttributeModifier(cha)
    }

    return abilityModifiers
  }

  function fillInSkillTable(encounterGroup, modifiers, proficiencyBonus, archetype) {
    encounterGroup.find('.js-acrobatics').text(calculateSkillModifier(modifiers.dex, proficiencyBonus, isProficientWithSkill(archetype, 'acrobatics')))
    encounterGroup.find('.js-animal-handling').text(calculateSkillModifier(modifiers.wis, proficiencyBonus, isProficientWithSkill(archetype, 'animal-handling')))
    encounterGroup.find('.js-arcana').text(calculateSkillModifier(modifiers.int, proficiencyBonus, isProficientWithSkill(archetype, 'arcana')))
    encounterGroup.find('.js-athletics').text(calculateSkillModifier(modifiers.str, proficiencyBonus, isProficientWithSkill(archetype, 'athletics')))
    encounterGroup.find('.js-deception').text(calculateSkillModifier(modifiers.cha, proficiencyBonus, isProficientWithSkill(archetype, 'deception')))
    encounterGroup.find('.js-history').text(calculateSkillModifier(modifiers.int, proficiencyBonus, isProficientWithSkill(archetype, 'history')))
    encounterGroup.find('.js-insight').text(calculateSkillModifier(modifiers.wis, proficiencyBonus, isProficientWithSkill(archetype, 'insight')))
    encounterGroup.find('.js-intimidation').text(calculateSkillModifier(modifiers.cha, proficiencyBonus, isProficientWithSkill(archetype, 'intimidation')))
    encounterGroup.find('.js-investigation').text(calculateSkillModifier(modifiers.int, proficiencyBonus, isProficientWithSkill(archetype, 'investigation')))
    encounterGroup.find('.js-medicine').text(calculateSkillModifier(modifiers.wis, proficiencyBonus, isProficientWithSkill(archetype, 'medicine')))
    encounterGroup.find('.js-nature').text(calculateSkillModifier(modifiers.int, proficiencyBonus, isProficientWithSkill(archetype, 'nature')))
    encounterGroup.find('.js-perception').text(calculateSkillModifier(modifiers.wis, proficiencyBonus, isProficientWithSkill(archetype, 'perception')))
    encounterGroup.find('.js-performance').text(calculateSkillModifier(modifiers.cha, proficiencyBonus, isProficientWithSkill(archetype, 'performance')))
    encounterGroup.find('.js-persuasion').text(calculateSkillModifier(modifiers.cha, proficiencyBonus, isProficientWithSkill(archetype, 'persuasion')))
    encounterGroup.find('.js-religion').text(calculateSkillModifier(modifiers.int, proficiencyBonus, isProficientWithSkill(archetype, 'religion')))
    encounterGroup.find('.js-sleight-of-hand').text(calculateSkillModifier(modifiers.dex, proficiencyBonus, isProficientWithSkill(archetype, 'sleight-of-hand')))
    encounterGroup.find('.js-stealth').text(calculateSkillModifier(modifiers.dex, proficiencyBonus, isProficientWithSkill(archetype, 'stealth')))
    encounterGroup.find('.js-survival').text(calculateSkillModifier(modifiers.wis, proficiencyBonus, isProficientWithSkill(archetype, 'survival')))
  }

  function fillInReaction(encounterGroup, archetype, proficiencyBonus) {
    if(archetype.reactions.length > 0) {
      var reaction = archetype.reactions[d(archetype.reactions.length) - 1]
      encounterGroup.find('.js-reactions-list').append(
        '<div>'+
          '<b><i>' + reaction.name + '</i></b> ' +
          reaction.description(proficiencyBonus) +
        '</div>'
      )
      encounterGroup.find('.reactions').toggle()
    }
  }

  function fillInCasterSchool(encounterGroup, archetype) {
    var school = archetype.school[d(archetype.school.length) - 1]
    encounterGroup.find('.js-name').prepend(school.name + ' ')
    for(i = 0; i < school.spells.length; i++) {
      var spells = '<div>' + school.spells[i].level + ': '
      for(j = 0; j < school.spells[i].spells.length; j++) {
        spells += '<i>' +
          '<a target="_blank" href="https://thegrimoire.xyz/spells/' + school.spells[i].spells[j].replace(' ', '-') + '">' +
            school.spells[i].spells[j] +
          '</a>, '
        '</i>'
      }
      spells += '</div>'
      if(i === 0 || $.isNumeric(encounterGroup.find('.js-' + i + '-slot').text())) {
        encounterGroup.find('.js-spellcasting').append(spells)
      }
    }
  }
</script>
