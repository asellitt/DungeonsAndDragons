---
layout: tool
title: Dungeon Revealer
---

<div id="dungeon">
    <div>
        <input type="text" id="map" placeholder="dungeon code" />
        <table>
            <tr>
                <td>
                    <label><input type="checkbox" id="R1" />Room 1</label>
                    <label><input type="checkbox" id="R1S" />(Secret 1)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R11" />Room 11</label>
                    <label>
                        <input type="checkbox" id="R11S" />(Secret 11)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R21" />Room 21</label>
                    <label>
                        <input type="checkbox" id="R21S" />(Secret 21)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R31" />Room 31</label>
                    <label>
                        <input type="checkbox" id="R31S" />(Secret 31)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R41" />Room 41</label>
                    <label>
                        <input type="checkbox" id="R41S" />(Secret 41)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R2" />Room 2</label>
                    <label><input type="checkbox" id="R2S" />(Secret 2)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R12" />Room 12</label>
                    <label>
                        <input type="checkbox" id="R12S" />(Secret 12)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R22" />Room 22</label>
                    <label>
                        <input type="checkbox" id="R22S" />(Secret 22)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R32" />Room 32</label>
                    <label>
                        <input type="checkbox" id="R32S" />(Secret 32)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R42" />Room 42</label>
                    <label>
                        <input type="checkbox" id="R42S" />(Secret 42)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R3" />Room 3</label>
                    <label><input type="checkbox" id="R3S" />(Secret 3)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R13" />Room 13</label>
                    <label>
                        <input type="checkbox" id="R13S" />(Secret 13)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R23" />Room 23</label>
                    <label>
                        <input type="checkbox" id="R23S" />(Secret 23)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R33" />Room 33</label>
                    <label>
                        <input type="checkbox" id="R33S" />(Secret 33)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R43" />Room 43</label>
                    <label>
                        <input type="checkbox" id="R43S" />(Secret 43)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R4" />Room 4</label>
                    <label><input type="checkbox" id="R4S" />(Secret 4)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R14" />Room 14</label>
                    <label>
                        <input type="checkbox" id="R14S" />(Secret 14)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R24" />Room 24</label>
                    <label>
                        <input type="checkbox" id="R24S" />(Secret 24)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R34" />Room 34</label>
                    <label>
                        <input type="checkbox" id="R34S" />(Secret 34)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R44" />Room 44</label>
                    <label>
                        <input type="checkbox" id="R44S" />(Secret 44)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R5" />Room 5</label>
                    <label><input type="checkbox" id="R5S" />(Secret 5)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R15" />Room 15</label>
                    <label>
                        <input type="checkbox" id="R15S" />(Secret 15)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R25" />Room 25</label>
                    <label>
                        <input type="checkbox" id="R25S" />(Secret 25)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R35" />Room 35</label>
                    <label>
                        <input type="checkbox" id="R35S" />(Secret 35)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R45" />Room 45</label>
                    <label>
                        <input type="checkbox" id="R45S" />(Secret 45)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R6" />Room 6</label>
                    <label><input type="checkbox" id="R6S" />(Secret 6)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R16" />Room 16</label>
                    <label>
                        <input type="checkbox" id="R16S" />(Secret 16)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R26" />Room 26</label>
                    <label>
                        <input type="checkbox" id="R26S" />(Secret 26)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R36" />Room 36</label>
                    <label>
                        <input type="checkbox" id="R36S" />(Secret 36)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R46" />Room 46</label>
                    <label>
                        <input type="checkbox" id="R46S" />(Secret 46)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R7" />Room 7</label>
                    <label><input type="checkbox" id="R7S" />(Secret 7)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R17" />Room 17</label>
                    <label>
                        <input type="checkbox" id="R17S" />(Secret 17)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R27" />Room 27</label>
                    <label>
                        <input type="checkbox" id="R27S" />(Secret 27)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R37" />Room 37</label>
                    <label>
                        <input type="checkbox" id="R37S" />(Secret 37)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R47" />Room 47</label>
                    <label>
                        <input type="checkbox" id="R47S" />(Secret 47)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R8" />Room 8</label>
                    <label><input type="checkbox" id="R8S" />(Secret 8)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R18" />Room 18</label>
                    <label>
                        <input type="checkbox" id="R18S" />(Secret 18)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R28" />Room 28</label>
                    <label>
                        <input type="checkbox" id="R28S" />(Secret 28)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R38" />Room 38</label>
                    <label>
                        <input type="checkbox" id="R38S" />(Secret 38)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R48" />Room 48</label>
                    <label>
                        <input type="checkbox" id="R48S" />(Secret 48)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R9" />Room 9</label>
                    <label><input type="checkbox" id="R9S" />(Secret 9)</label>
                </td>
                <td>
                    <label><input type="checkbox" id="R19" />Room 19</label>
                    <label>
                        <input type="checkbox" id="R19S" />(Secret 19)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R29" />Room 29</label>
                    <label>
                        <input type="checkbox" id="R29S" />(Secret 29)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R39" />Room 39</label>
                    <label>
                        <input type="checkbox" id="R39S" />(Secret 39)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R49" />Room 49</label>
                    <label>
                        <input type="checkbox" id="R49S" />(Secret 49)
                    </label>
                </td>
            </tr>
            <tr>
                <td>
                    <label><input type="checkbox" id="R10" />Room 10</label>
                    <label>
                        <input type="checkbox" id="R10S" />(Secret 10)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R20" />Room 20</label>
                    <label>
                        <input type="checkbox" id="R20S" />(Secret 20)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R30" />Room 30</label>
                    <label>
                        <input type="checkbox" id="R30S" />(Secret 30)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R40" />Room 40</label>
                    <label>
                        <input type="checkbox" id="R40S" />(Secret 40)
                    </label>
                </td>
                <td>
                    <label><input type="checkbox" id="R50" />Room 50</label>
                    <label>
                        <input type="checkbox" id="R50S" />(Secret 50)
                    </label>
                </td>
            </tr>
        </table>
    </div>
    <div>
        <a id="encoded" href=""></a>
    </div>
    <pre id="data"></pre>

    <script>
        function onChange() {
            updateData();
            updateUrl(encodeData());
            updateUI();
        }

        function updateData() {
            var roomSet = new Set();
            var secretSet = new Set();
            data.m = document.getElementById("map").value;
            for (var i = 1; i <= 50; i++) {
                var room = document.getElementById("R" + i).checked;
                if (room) {
                    roomSet.add(i);
                }

                var secret = document.getElementById("R" + i + "S").checked;
                if (secret) {
                    secretSet.add(i);
                }
            }
            data.r = [...roomSet];
            data.s = [...secretSet];
        }

        function decodeData() {
            var encodedData = new URL(location.href).searchParams.get("d");
            var data =
                encodedData !== null
                    ? JSON.parse(atob(encodedData))
                    : {
                          m: "",
                          r: [],
                          s: [],
                      };
            return data;
        }

        function encodeData() {
            var encodedData = btoa(JSON.stringify(data));
            console.log(`encodedData: ${encodedData}`);
            document.getElementById("encoded").innerHTML = encodedData;
            document.getElementById("encoded").href = "{{ '/dungeon' | prepend: site.baseurl }}?d=" + encodedData;
            return encodedData;
        }

        function updateUrl(encodedData) {
            var searchParams = new URLSearchParams(window.location.search);
            searchParams.set("d", encodedData);
            window.location.search = searchParams.toString();
            console.log(`searchParams: ${searchParams}`);
            console.log(`searchParams.toString: ${searchParams.toString()}`);
        }

        function updateUI() {
            document.getElementById("map").value = data.m;
            data.r.forEach((room) => {
                document.getElementById("R" + room).checked = true;
            });
            data.s.forEach((secretRoom) => {
                document.getElementById("R" + secretRoom + "S").checked = true;
            });
            document.getElementById("data").innerHTML = JSON.stringify(
                data,
                null,
                2
            );
        }

        var data = decodeData();
        encodeData();
        updateUI();

        document
            .getElementById("map")
            .addEventListener("change", (e) => onChange());
        document.querySelectorAll("[type='checkbox']").forEach((node) => {
            node.addEventListener("change", (e) => onChange());
        });
    </script>

    <style>
        table {
            border-collapse: collapse;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        td {
            border: 1px solid black;
        }

        label {
            width: 100px;
            display: inline-block;
        }
    </style>
</div>
